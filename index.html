<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fairy Tale Island</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alegreya+SC:ital,wght@0,400;0,500;0,700;0,800;0,900;1,400;1,500;1,700;1,800;1,900&family=Cinzel+Decorative:wght@400;700;900&family=Macondo:wght@400&family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
   <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/TextPlugin.min.js"></script> -->
</head>
<body>

    <div class="container">
        <!-- Help/Info button -->
        <div id="helpButton">?</div>
        
        <!-- Help popup modal -->
        <div id="helpModal" class="modal hidden">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>What's the Fairy Tale Navigator</h2>
                <div class="help-section">
                    <h3>ðŸ“š Explore Connected Stories</h3>
                    <p>Select a text section to find similar passages from other fairy tale texts -- using an in-browser embedding index and search. There is no server! As you browse the story lines, watch for highlighted elements that fly into various categories. If you want to try to fill in various category buckets, you will want to select text that might "lead you" somewhere. Magical creatures are harder than you might think.</p>
                </div>
                <div class="help-section">
                    <h3>ðŸŽ¯ Category Buckets</h3>
                    <p>The icons were made with a glif.ai app that uses a Flux lora for a medieval style adds a label. Numbers show how many times each theme has appeared in your exploration.  They were originally seeded by looking at top unigram and bigrams, then added to during use.</p>
                </div>
                <div class="help-section">
                    <h3>Selection Similarity Embeddings</h3>
                    <p>The score shows how "similar" a new text is to what you selected. This uses a tiny embedding model, <a href="https://huggingface.co/TaylorAI/bge-micro">bge-micro,</a> and transformers.js. The index and similarity in the browser are handled with client-vector-search.</p>
                </div>
                <div class="help-section">
                    <h3>Text Source</h3>
                    <p>The text is sourced from Gutenberg books fairy tales, processed into sentences and then classified for "descriptiveness" after training a small spaCy model. The dataset was later reduced quite a bit to a few authors, for this demo app.</p>
                </div>
                <div class="help-section">
                    <h3>Who Made This and Where?</h3>
                    <p>This was originally both a tech demo (making an in-browser fairy tale text navigator) and a toy for me to look at fairy tales. Made by <a href="https://x.com/arnicas">@arnicas</a>, the repo is at <a href="https://github.com/arnicas/fairy-tale-navigator">github.com/arnicas/fairy-tale-navigator</a>.</p>
                </div>
            </div>
        </div>

        <!-- Category Detail Modal -->
        <div id="categoryModal" class="modal hidden">
            <div class="modal-content category-modal-content">
                <span class="close" id="categoryModalClose">&times;</span>
                <div id="categoryModalBody">
                    <img id="categoryModalImage" alt="" class="category-modal-image" style="display: none;">
                    <h2 id="categoryModalTitle"></h2>
                    <div id="categoryModalCount" class="category-modal-count"></div>
                    <div id="categoryModalMatches" class="category-modal-matches"></div>
                </div>
            </div>
        </div>
        
        <!--
        <div class="sidebar" id="sidebar">
            <button id="toggleSidebar">Open Scores</button>
            <div id="score-container" class="hidden">
                <div class="score-column">
                </div>
            </div>
        </div>
        -->
        <div id="content">
            <div id="loading">
                <div id="loaderText">Loading...</div>
            </div>
            <div id="message"></div>

            <h1 id="appTitle">Fairy Tale Text Navigator</h1>
            
            <div id="instructions">Select a section of text to search for a new line!</div>
            
            <div id="textContainer">
                <div id="text">When we re-tell the old tales of our ancestors, we sit beside them over the peat-fire; and, as we glory with them in their strong heroes, and share their elemental joys and fears, we breathe the palpitating air of that old mysterious world of theirs, peopled by spirits beautiful, and strange, and awe-inspiring.</div>
                <div id="animation"></div>
            </div>
            <div id="sourceContainer">
                <div id="titlerow">
                    <div class="relatedItems" id="relatedTitle">Elves and Heroes</div>
                    <div class="relatedItems" id="relatedAuthor">Donald Mackenzie</div>
                </div>
                <div id="otherRows">
                    <div class="relatedItems" id="relatedStoryTitle"></div>
                    <div class="relatedItems" id="relatedScore"></div>
                </div>
            </div>
            <div id="categoryContainer">
                <div id="categoryBuckets"></div>
            </div>
            <!--
            <div id="chartSection">
                <div id="chartContainer" class="chart-container hidden">
                    <div class="chart" id="scatterplot"></div>
                </div>
                <button id="toggleChart">Show map</button>
            </div> 
            -->
        </div> 
        
    </div>
    
        <link rel="stylesheet" href="static/main.css">
        <script type="module" src="static/js/main.js"></script>

</body>
</html>